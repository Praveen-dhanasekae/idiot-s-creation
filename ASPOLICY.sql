--------------------------------------------------------
--  File created - Friday-May-11-2018   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Table ASPOLICY
--------------------------------------------------------

  CREATE TABLE "TPA_DEV_APP01"."ASPOLICY" 
   (	"POLICYGUID" CHAR(36 BYTE), 
	"POLICYNUMBER" VARCHAR2(60 BYTE), 
	"POLICYNAME" VARCHAR2(300 BYTE), 
	"CREATIONDATE" TIMESTAMP (6), 
	"ISSUESTATECODE" VARCHAR2(2 CHAR), 
	"PLANDATE" TIMESTAMP (6), 
	"STATUSCODE" VARCHAR2(2 CHAR), 
	"COMPANYGUID" CHAR(36 BYTE), 
	"PLANGUID" CHAR(36 BYTE), 
	"XMLDATA" CLOB, 
	"UPDATEDGMT" TIMESTAMP (6), 
	"SYSTEMCODE" VARCHAR2(6 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TPA_DEV_APP01_DATA" 
 LOB ("XMLDATA") STORE AS BASICFILE (
  TABLESPACE "TPA_DEV_APP01_DATA" ENABLE STORAGE IN ROW CHUNK 8192 RETENTION 
  NOCACHE LOGGING 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;
REM INSERTING into TPA_DEV_APP01.ASPOLICY
SET DEFINE OFF;
Insert into TPA_DEV_APP01.ASPOLICY (POLICYGUID,POLICYNUMBER,POLICYNAME,CREATIONDATE,ISSUESTATECODE,PLANDATE,STATUSCODE,COMPANYGUID,PLANGUID,UPDATEDGMT,SYSTEMCODE) values ('F6B68BDB-29DF-4657-9836-B2AEE2AEE24C','CTL0237296',null,to_timestamp('07-SEP-16 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'05',to_timestamp('07-SEP-16 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'58','18B611A8-4429-4C67-94E6-3F4A882C9A8D','82A8DDC6-5410-6392-A17A-AC466FA15C01',to_timestamp('09-MAY-17 01.26.36.897000000 PM','DD-MON-RR HH.MI.SSXFF AM'),'01');
Insert into TPA_DEV_APP01.ASPOLICY (POLICYGUID,POLICYNUMBER,POLICYNAME,CREATIONDATE,ISSUESTATECODE,PLANDATE,STATUSCODE,COMPANYGUID,PLANGUID,UPDATEDGMT,SYSTEMCODE) values ('01EEFFB2-747B-4356-9399-F6EB81BC6444','CTL0237299',null,to_timestamp('07-SEP-16 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'02',to_timestamp('07-SEP-16 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'08','18B611A8-4429-4C67-94E6-3F4A882C9A8D','82A8DDC6-5410-6392-A17A-AC466FA15C01',to_timestamp('08-MAY-17 10.42.01.761000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'01');
Insert into TPA_DEV_APP01.ASPOLICY (POLICYGUID,POLICYNUMBER,POLICYNAME,CREATIONDATE,ISSUESTATECODE,PLANDATE,STATUSCODE,COMPANYGUID,PLANGUID,UPDATEDGMT,SYSTEMCODE) values ('4BE694F6-DA40-42B5-8307-B99CE00F18BA','CTL0237297',null,to_timestamp('07-SEP-16 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'02',to_timestamp('07-SEP-14 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'01','18B611A8-4429-4C67-94E6-3F4A882C9A8D','82A8DDC6-5410-6392-A17A-AC466FA15C01',to_timestamp('09-MAY-17 01.02.31.938000000 PM','DD-MON-RR HH.MI.SSXFF AM'),'01');
Insert into TPA_DEV_APP01.ASPOLICY (POLICYGUID,POLICYNUMBER,POLICYNAME,CREATIONDATE,ISSUESTATECODE,PLANDATE,STATUSCODE,COMPANYGUID,PLANGUID,UPDATEDGMT,SYSTEMCODE) values ('E0406C55-5E98-4601-B83A-B26D490A6B5A','CTL0237298',null,to_timestamp('07-SEP-16 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'02',to_timestamp('22-MAY-15 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'08','18B611A8-4429-4C67-94E6-3F4A882C9A8D','82A8DDC6-5410-6392-A17A-AC466FA15C01',to_timestamp('11-APR-17 10.37.09.431000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'01');
Insert into TPA_DEV_APP01.ASPOLICY (POLICYGUID,POLICYNUMBER,POLICYNAME,CREATIONDATE,ISSUESTATECODE,PLANDATE,STATUSCODE,COMPANYGUID,PLANGUID,UPDATEDGMT,SYSTEMCODE) values ('879D7E38-3A05-4995-B4AC-2B5A666B6405','CTL0237498',null,to_timestamp('07-SEP-16 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'07',to_timestamp('07-SEP-16 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'08','18B611A8-4429-4C67-94E6-3F4A882C9A8D','82A8DDC6-5410-6392-A17A-AC466FA15C01',to_timestamp('10-MAY-17 01.38.16.070000000 PM','DD-MON-RR HH.MI.SSXFF AM'),'01');
Insert into TPA_DEV_APP01.ASPOLICY (POLICYGUID,POLICYNUMBER,POLICYNAME,CREATIONDATE,ISSUESTATECODE,PLANDATE,STATUSCODE,COMPANYGUID,PLANGUID,UPDATEDGMT,SYSTEMCODE) values ('1BDEC6A5-F6A9-4F9C-9948-463D9322A77E','CTL0237499',null,to_timestamp('07-SEP-16 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'13',to_timestamp('07-FEB-15 12.00.00.000000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'08','18B611A8-4429-4C67-94E6-3F4A882C9A8D','82A8DDC6-5410-6392-A17A-AC466FA15C01',to_timestamp('17-MAY-17 10.16.12.676000000 AM','DD-MON-RR HH.MI.SSXFF AM'),'01');
--------------------------------------------------------
--  DDL for Index IX_1_ASPOLICY
--------------------------------------------------------

  CREATE INDEX "TPA_DEV_APP01"."IX_1_ASPOLICY" ON "TPA_DEV_APP01"."ASPOLICY" ("POLICYNUMBER", "COMPANYGUID", "PLANGUID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TPA_DEV_APP01_DATA" ;
--------------------------------------------------------
--  DDL for Index IX_2_ASPOLICY
--------------------------------------------------------

  CREATE INDEX "TPA_DEV_APP01"."IX_2_ASPOLICY" ON "TPA_DEV_APP01"."ASPOLICY" ("COMPANYGUID", "PLANGUID", "POLICYGUID", "STATUSCODE", "POLICYNUMBER") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TPA_DEV_APP01_DATA" ;
--------------------------------------------------------
--  DDL for Index SQL141103144245290
--------------------------------------------------------

  CREATE UNIQUE INDEX "TPA_DEV_APP01"."SQL141103144245290" ON "TPA_DEV_APP01"."ASPOLICY" ("POLICYGUID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TPA_DEV_APP01_DATA" ;
--------------------------------------------------------
--  DDL for Index CI_1_ASPOLICY
--------------------------------------------------------

  CREATE INDEX "TPA_DEV_APP01"."CI_1_ASPOLICY" ON "TPA_DEV_APP01"."ASPOLICY" (NLSSORT("COMPANYGUID",'nls_sort=''BINARY_CI'''), NLSSORT("PLANGUID",'nls_sort=''BINARY_CI'''), NLSSORT("POLICYNUMBER",'nls_sort=''BINARY_CI'''), NLSSORT("STATUSCODE",'nls_sort=''BINARY_CI'''), NLSSORT("POLICYGUID",'nls_sort=''BINARY_CI''')) 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TPA_DEV_APP01_DATA" ;
--------------------------------------------------------
--  DDL for Index CI_2_ASPOLICY
--------------------------------------------------------

  CREATE INDEX "TPA_DEV_APP01"."CI_2_ASPOLICY" ON "TPA_DEV_APP01"."ASPOLICY" (NLSSORT("COMPANYGUID",'nls_sort=''BINARY_CI'''), NLSSORT("POLICYGUID",'nls_sort=''BINARY_CI''')) 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TPA_DEV_APP01_DATA" ;
--------------------------------------------------------
--  DDL for Index CI_3_ASPOLICY
--------------------------------------------------------

  CREATE INDEX "TPA_DEV_APP01"."CI_3_ASPOLICY" ON "TPA_DEV_APP01"."ASPOLICY" (NLSSORT("POLICYGUID",'nls_sort=''BINARY_CI''')) 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TPA_DEV_APP01_DATA" ;
--------------------------------------------------------
--  Constraints for Table ASPOLICY
--------------------------------------------------------

  ALTER TABLE "TPA_DEV_APP01"."ASPOLICY" ADD CONSTRAINT "SQL141103144245290" PRIMARY KEY ("POLICYGUID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TPA_DEV_APP01_DATA"  ENABLE;
  ALTER TABLE "TPA_DEV_APP01"."ASPOLICY" MODIFY ("POLICYGUID" NOT NULL ENABLE);
  ALTER TABLE "TPA_DEV_APP01"."ASPOLICY" MODIFY ("STATUSCODE" NOT NULL ENABLE);
  ALTER TABLE "TPA_DEV_APP01"."ASPOLICY" MODIFY ("SYSTEMCODE" NOT NULL ENABLE);
--------------------------------------------------------
--  DDL for Trigger TRG_CLASSIC_ASPOLICY_D
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "TPA_DEV_APP01"."TRG_CLASSIC_ASPOLICY_D" AFTER DELETE ON ASPOLICY FOR EACH ROW
DECLARE
	V_SYSTEMDATE TIMESTAMP DEFAULT NULL;
BEGIN
	ASE_TABLE_CHANGE_INSERT('AsPolicy_Delete', :old.POLICYGUID, '00', V_SYSTEMDATE); 
END;
/
ALTER TRIGGER "TPA_DEV_APP01"."TRG_CLASSIC_ASPOLICY_D" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_CLASSIC_ASPOLICY_I
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "TPA_DEV_APP01"."TRG_CLASSIC_ASPOLICY_I" AFTER INSERT ON ASPOLICY FOR EACH ROW
DECLARE 
	V_SYSTEMDATE TIMESTAMP DEFAULT NULL;
BEGIN
	ASE_TABLE_CHANGE_INSERT('AsPolicy', :new.POLICYGUID, '01', V_SYSTEMDATE);
	-- CHANGED FOR PAYMODE PROJECT PR-5809, NEED TO SEND NEW POLICIES TO BANK EVERY NIGHT
	INSERT INTO CLASSIC_TABLE_CHANGES_POLICY (SYSTEMDATE, POLICYGUID, UPDATETIMESTAMP, OLDSTATUS, NEWSTATUS)
	VALUES(V_SYSTEMDATE, :new.POLICYGUID, CURRENT_TIMESTAMP, NULL, :new.STATUSCODE);
END;
/
ALTER TRIGGER "TPA_DEV_APP01"."TRG_CLASSIC_ASPOLICY_I" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_CLASSIC_ASPOLICY_U
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "TPA_DEV_APP01"."TRG_CLASSIC_ASPOLICY_U" AFTER UPDATE ON ASPOLICY FOR EACH ROW
	                         WHEN (old.POLICYNUMBER <> new.POLICYNUMBER OR old.POLICYNAME <> new.POLICYNAME OR old.CREATIONDATE <> new.CREATIONDATE 
    OR old.ISSUESTATECODE <> new.ISSUESTATECODE OR old.PLANDATE <> new.PLANDATE OR old.STATUSCODE <> new.STATUSCODE 
    OR old.COMPANYGUID <> new.COMPANYGUID OR old.PLANGUID <> new.PLANGUID 
  OR (old.POLICYNUMBER IS NULL AND new.POLICYNUMBER IS NOT NULL) 
  OR (old.POLICYNAME IS NULL AND new.POLICYNAME IS NOT NULL) 
  OR (old.CREATIONDATE IS NULL AND new.CREATIONDATE IS NOT NULL) 
  OR (old.ISSUESTATECODE IS NULL AND new.ISSUESTATECODE IS NOT NULL) 
  OR (old.PLANDATE IS NULL AND new.PLANDATE IS NOT NULL) 
  OR (old.STATUSCODE IS NULL AND new.STATUSCODE IS NOT NULL) 
  OR (old.COMPANYGUID IS NULL AND new.COMPANYGUID IS NOT NULL) 
  OR (old.PLANGUID IS NULL AND new.PLANGUID IS NOT NULL)
	OR (old.POLICYNUMBER IS NOT NULL AND new.POLICYNUMBER IS NULL) 
  OR (old.POLICYNAME IS NOT NULL AND new.POLICYNAME IS NULL) 
  OR (old.CREATIONDATE IS NOT NULL AND new.CREATIONDATE IS NULL) 
  OR (old.ISSUESTATECODE IS NOT NULL AND new.ISSUESTATECODE IS NULL) 
  OR (old.PLANDATE IS NOT NULL AND new.PLANDATE IS NULL) 
  OR (old.STATUSCODE IS NOT NULL AND new.STATUSCODE IS NULL) 
  OR (old.COMPANYGUID IS NOT NULL AND new.COMPANYGUID IS NULL) 
  OR (old.PLANGUID IS NOT NULL AND new.PLANGUID IS NULL)
  ) DECLARE
	V_SYSTEMDATE TIMESTAMP DEFAULT NULL;
BEGIN
	ASE_TABLE_CHANGE_INSERT('AsPolicy', :new.POLICYGUID, '01', V_SYSTEMDATE);
	IF :old.STATUSCODE <> :new.STATUSCODE 
	THEN	INSERT INTO CLASSIC_TABLE_CHANGES_POLICY (SYSTEMDATE, POLICYGUID, UPDATETIMESTAMP, OLDSTATUS, NEWSTATUS)
			VALUES(V_SYSTEMDATE, :new.POLICYGUID, CURRENT_TIMESTAMP, :old.STATUSCODE, :new.STATUSCODE);
	END IF;
END;
/
ALTER TRIGGER "TPA_DEV_APP01"."TRG_CLASSIC_ASPOLICY_U" ENABLE;
